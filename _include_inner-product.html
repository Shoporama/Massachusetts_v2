<{strip}>
<{assign var="news_until" value=$settings.globale.NyhedIndtil|default:480}>
<{assign var="innerproduct" value="product_cache_"|cat:$product->getProductId()}>
<{if $settings.Caching.MaxLevetidProduktTeaser && $settings.Caching.MinLevetidProduktTeaser}>
    <{assign var="randomttl" value=$settings.Caching.MinLevetidProduktTeaser|mt_rand:$settings.Caching.MaxLevetidProduktTeaser}>
<{else}>
    <{assign var="randomttl" value=43200|mt_rand:86400}>
<{/if}>

<{get_cache name=$innerproduct ttl=$randomttl assign="inner_product_cached_data"}>

<{if $inner_product_cached_data}>

    <{$inner_product_cached_data}>

<{else}>

    <{cache name=$innerproduct}>

<{assign var="splat" value=$product->getMetaValue('splat') }>
<{assign var="images" value=$product->getImages()}>
<{assign var="supplier" value=$product->getSupplier()}>
<{assign var="stock" value=$product->getInStockVariants()}>

<li rel="product" data-id="<{$product->getProductId()}>"<{if $supplier}> data-brand="<{$supplier->getName()}>" <{/if}> class="col-xs-12 col-sm-4 col-md-3 product-teaser <{$product->getCategoryNames("filter-"," ")}> <{if $supplier}> filter-<{$supplier->getName()|lower|replace:' ':'_'|replace:'.':'_'}><{/if}>" itemscope itemtype="http://schema.org/Product">
    <div class="product-teaser-inner">
        <a href="<{$product->getRemoteUrl()|escape}>" title="<{$product->getName()|escape}>">
            <div class="sizes">
                <{if $stock}>
                <span>Varianter på lager:</span>
                <ul>
                    <{assign var="c" value=0}>
                    <{section name="a" loop=$stock}>
                        <{if $stock[a].attribute_value_id > 1}>
                            <{if $c < 10}>
                                <li><{$stock[a].name}></li>
                            <{elseif $c == 10}>
                                <li>mere...</li>
                            <{/if}>
                        <{/if}>
                    <{/section}>
                </ul>
                <{else}>
                <span>Produktet er i restordre:</span>
                <ul>
                    <li>Skriv dig op til at få besked, når vi får nye på lager.</li>
                </ul>
                <{/if}>
            </div>
            <{section name="j" loop=$images start=0 max=1}>
                <img src="<{$theme_url}>/img/spinner.gif" data-layzr="<{$images[j]->getSrc(240,240, 'box')}>" data-layzr-retina="<{$images[j]->getSrc(500,500, 'box')}>" class="product-image" itemprop="image" content="<{$images[j]->getSrc(400,400, 'box')}>" alt="<{$images[j]->getDescription()|escape}>" />
            <{/section}>

            <{if $product->getSalePrice() > 0}>
                <div class="product-teaser-highlight offer">
                    <{math assign="pricedif" equation='a-b' a=$product->getPrice() b=$product->getSalePrice() }>
                    <{math assign="savepercent" equation='c/d*100' c=$pricedif d=$product->getPrice()}>
                    -<{$savepercent|number_format:0}>%
                </div>
            <{elseif $product->getOnlineHours() < $news_until}>
                <div class="product-teaser-highlight news">NYHED</div>
            <{/if}>

            <div class="product-teaser-meta">
                <div class="product-teaser-title" itemprop="name"><{$product->getName()|escape}></div>
                <div class="product-teaser-brand" itemprop="brand"><{if $supplier}><{$supplier->getName()}><{/if}></div>
                <div class="product-teaser-text" itemprop="description"><{$product->getListDescription()|escape}></div>
                <div class="product-teaser-price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                    <{if $product->getSalePrice()}>
                        <div class="product-teaser-price-before"><span><{$webshop->getCurrency()}></span> <span class="beforeprice"><{$product->getPrice()|number_format:2:",":"."}></span></div>
                    <{/if}>
                    <div class="product-teaser-price-current">
                        <span itemprop="priceCurrency" class="product-teaser-currency"><{$webshop->getCurrency()}></span>&nbsp;<span itemprop="price" class="product-teaser-price" content="<{$product->getRealPrice()|number_format:2:".":""}>"><{$product->getRealPrice()|number_format:2:",":"."}></span>
                    </div>
                    <{if $product->getIsInStock()}>
                        <span class="product-teaser-availability instock" >På lager</span>
                        <link itemprop="availability" href="http://schema.org/InStock" />
                    <{else}>
                        <span class="product-teaser-availability outofstock">Ikke på lager</span>
                    <{/if}>
                </div>
            </div>
        </a>

        <{if $settings.Produktlister.Laegikurvfraliste == 'ja'}>
            <{if $product->getIsInStock()}>
                <form action="" method="post" class="putinbasketform">
                    <input type="hidden" name="product_id" value="<{$product->getProductId()}>"/>
                    <input type="hidden" name="redirect" value="<{$product->getMetaValue('redirect')|escape}>"/>
                    <input type="hidden" class="form-control amount-input" name="amount" value="1">
                    <div class="product-teaser-cta">
                        <{if $product->hasVariant()}>
                            <{if $stock}>
                                <{if $stock[j].data_type == "valuelist"}>
                                    <select name="attributes[<{$stock[j].attribute_id}>]" id="a<{$stock[j].attribute_id}>" class="product-variant-selectbox" required="required">
                                        <option value="" disabled="disabled" selected>Vælg variant</option>
                                        <{section name="j" loop=$stock}>
                                        <{if $stock[j].attribute_value_id > 1}>
                                        <{assign var="attribute_price" value=$stock[j].variant_price_incl_vat)}>
                                        <option value="<{$stock[j].attribute_value_id}>" data-stockamount="<{$stock[j].cnt}>">
                                            <{$stock[j].name}> (<{$stock[j].cnt}> på lager)
                                            <{if $attribute_price > 0}>
                                            &nbsp;(<{$attribute_price|number_format:2:",":"."}> <{$webshop->getCurrency()}>)
                                            <{/if}>
                                        </option>
                                        <{/if}>
                                        <{/section}>
                                    </select>
                                <{elseif $stock[j].data_type == "string"}>
                                    <input type="text" name="attributes[<{$stock[0].attribute_id}>]" id="a<{$stock[0].attribute_id}>" class="attribute"/>
                                <{elseif $stock[j].data_type == "integer"}>
                                    <input type="text" name="attributes[<{$stock[0].attribute_id}>]" id="a<{$stock[0].attribute_id}>" class="attribute"/>
                                <{elseif $stock[j].data_type == "boolean"}>
                                    <input type="checkbox" name="attributes[<{$stock[0].attribute_id}>]" value="1" id="a<{$stock[0].attribute_id}>" class="attribute"/>
                                <{/if}>
                            <{/if}>
                        <{else}>
                            <input type="hidden" class="single-stock-amount" value="<{$product->getInStock($attributes[0].id, $attributes[0].value_id)}>">
                        <{/if}>

                        <button class="product-teaser-readmore btn btn-primary" type="submit" value=" "><{$settings.Produktlister.Knaptekst_koeb|default:"Køb"}></button>
                    </div>
                </form>
            <{else}>
                <div class="product-teaser-cta">
                    <a href="<{$product->getRemoteUrl()|escape}>" class="product-teaser-readmore btn btn-primary"><{$settings.Produktlister.Knaptekst_ikkepaalager|default:"Ikke på lager"}></a>
                </div>
            <{/if}>
        <{else}>
            <div class="product-teaser-cta">
                <a href="<{$product->getRemoteUrl()|escape}>" class="product-teaser-readmore btn btn-primary"><{$settings.Produktlister.Knaptekst_laesmere|default:"Læs mere"}></a>
            </div>
        <{/if}>
    </div>
</li>
<{/cache}>
<{/if}><{/strip}>
